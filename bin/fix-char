#!/usr/bin/env node

var fs = require('fs'),
	file = process.argv[2];
	
function exit(err) {
	if (err) {
		console.error(err);
		process.exit(1);
	} else {
		process.exit(0);
	}
}

function decode(data, fn) {
	var str = data.replace(/&#(\d{4});/g, function (str, n) { return String.fromCharCode(n)});
	fn(str);
}

function onDecode(data) {
	fs.writeFile(file, data, 'utf8', function (err) {
		if (err) {
			exit(err);
		} else {
			exit();
		}
	});
}

function onReadFile(err, data) {
	if (err) {
		exit(err);
	} else {
		decode(data, onDecode);
	}
}

if (!file) {
	exit('no file');
}

fs.readFile(file, 'utf8', onReadFile);